# Build the docker file.
docker build . -f Dockerfile -t internship

# Tag the built image
docker tag internship:latest  eu.gcr.io/ruse-xgcp/internship:latest

# Push the image
docker push eu.gcr.io/ruse-xgcp/internship:latest

# get a TPU instance and set.
TPU_IP_ADDRESS=$TPU_IP_ADDRESS

# use the docker file interactively
docker run -it --shm-size 100G -e XRT_TPU_CONFIG="tpu_worker;0;$TPU_IP_ADDRESS:8470"   --volume /home/rabeeh/ruse/:/home/rabeeh/ruse  eu.gcr.io/ruse-xgcp/internship:latest

cd home/rabeeh/internship/
python setup.py develop

cd seq2seq/
python finetune_t5_trainer.py configs/test.json

xcloud seq2seq/google/launch_xla.py  -- --config_path seq2seq/configs/meta_adapter_experiments/finetune-2e-5.json  --job_name finetune2e-5
xcloud seq2seq/google/launch_xla.py  -- --config_path seq2seq/configs/meta_adapter_experiments/train_num_samples_gpu/finetune-100.json  --job_name finetune-100 --num_gpus 1

# compute task embeddings 
python compute_task_emb.py configs/meta_adapter_experiments/gpu/test.json
